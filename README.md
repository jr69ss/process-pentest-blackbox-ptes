# Blackbox Network Penetration Testing Process ([PTES](http://www.pentest-standard.org/index.php/PTES_Technical_Guidelines#) Based)

------

### Objective:

Find vulnerabilities and attack vectors, exploit them and develop a thoughtful retrospective with compelling evidence.

### Causes of vulnerabilities:

– Design and development errors
– Poor system configuration
– Human errors (specific or architectural)

## Engineering Process: (DRAFT v3)

### MS1 (Day 1-3)
#### Externally - Organization Profiling
  - DNS Scanning
    - [TheHarvester](https://github.com/laramies/theHarvester)
    ```theharvester -d <DOMAIN> -b all -v -n -\-t -l 500```
    - [Mxtoolbox](https://mxtoolbox.com/)
    - [ARIN](https://www.arin.net/)
    - [Robtex](https://www.robtex.com/)
    - [Dnsmap](https://github.com/makefu/dnsmap)
    ```dnsmap <DOMAIN> -w usr/share/wordlists/gvit_subdomain_wordlist.txt -r results.txt```
    
  - Email Scanning
    - [Hunter](https://hunter.io)
    - [Maltego CE](https://www.paterva.com)
    - [Have I Been Pwned](https://haveibeenpwned.com/)
    
  - Password Profiling
    - Based on intelligence gathered from Maltego CE, mostly emails and names
    - [CeWL](https://digi.ninja/projects/cewl.php)
    
  - DNS/IP Dorking
    - Google dorking - [pentest-tools](https://pentest-tools.com)
      - Directory listing vulnerabilities
      - Configuration files exposed
      - Database files exposed
      - Log files exposed
      - Backup and old files
      - Login pages
      - SQL errors
      - Publicly exposed documents
      - phpinfo()
    - [Google Hacking Database](https://www.exploit-db.com/google-hacking-database/)
  
  - TLS/SSL Analysis
    - [tlssled](https://tools.kali.org/information-gathering/tlssled)
    - [sslscan](https://github.com/rbsec/sslscan) (also called from tlssled)
    - [ssllabs.com] (requires host to have a domain name)
    
  - User Breach Lookup
    - Have I Been Pwned Lookup Script (https://github.com/GoVanguard/dradis-check-user-pwned)
    
  - User Password Lookup
    - GVIT Internal Password Database
    
#### Externally and Internally - Vulnerability Scanning
  - Network Vulnerability Scanning
    - [Shodan](https://www.shodan.io) (external only, passive scanning)
      - Run GVIT Shodan script for batch queries (requires Shodan API key)
        - pip install shodan
        - python shodanScript.py -h
    - [Sparta](https://sparta.secforce.com/) - Service and port enumeration with many integrations including Nikto, Hydra, etc.
    - [OpenVAS](http://www.openvas.org/) - NVT scanning. Set scan config to "Full and very deep ultimate." For white box testing, enter valid credentials into Credentials section under Configuration.
      - By default it is accessible at https://localhost:9392
      - Reset OpenVAS web UI user if necessary: ```openvasmd --user=admin --new-password=new_password```
      - Try not to scan more than one network at a time, due to potential reliability issues when doing so. Also for large networks, e.g. /16 and larger, break them up into multiple scans and only do one at a time. Simultaneous large scans can cause problems for OpenVAS.
    - [Nexpose](https://www.rapid7.com/products/nexpose/) - For white box testing, enter valid credentials.
    
  - Web Vulnerability Scanning
    - [Netsparker](https://www.netsparker.com/) - For white box testing, enter valid credentials.
    - [OWASP ZAP](https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project) - For white box testing, enter valid credentials.
    - [Nikto](https://cirt.net/Nikto2) (also called by Sparta)
    - [ASafaweb](https://asafaweb.com)
    
#### Wireless Vulnerability Scanning
  - [Airodump-ng](https://www.aircrack-ng.org/doku.php?id=airodump-ng) - For merely capturing handshakes, not exploitation or bruteforcing.


### MS2 (Day 3-5)
  - Dradis import of vulnerability data
  - Password Bruteforcing - Hydra (can be called from Sparta)
  - Exploitation Research
    - https://www.exploit-db.com/
    - http://www.securityfocus.com/
    - https://cxsecurity.com/
    - http://0day.today
    - http://siph0n.net/
    - https://minotr.net/
    - https://www.threatcrowd.org/
    - https://metadefender.opswat.com/threat-intelligence-feeds
    - https://www.threatminer.org/
    - http://data.netlab.360.com/
    - https://talosintelligence.com
    - https://cymon.io/
#### External Exploitation
  - Exploitation via Metasploit, scripts gathered from GitHub (including our own) and other sources
  - Additional web exploitation via manual testing based on vulnerabilities discovered by Netsparker, OWASP ZAP, Nexpose, and OpenVAS.
  - sqlninja / sqlmap / sqlmate (for SQL injection)
  - Screenshot all results and update Dradis issues
#### Internal Exploitation
  - DHCPig (DHCP exhaustion)
  - Yersinia (Layer 2 exploitation)
  - WireShark Traffic Sniffing
  - Windows SMB Traffic Capture using WireShark and Responder MDNS name poisoner (for NTLM cracking with Hashcat)
  - Exploitation via Metasploit, scripts gathered from GitHub (including our own) and other sources
  - Web exploitation via manual testing based on vulnerabilities discovered by Netsparker, OWASP ZAP, Nexpose, and OpenVAS.
  - sqlninja / sqlmap / sqlmate (for SQL injection)
  - Ncat (port testing and attempted shell access)
  - Screenshot all results and update Dradis issues
#### Wireless Exploitation
  - [WiFite](https://github.com/derv82/wifite2)
  - [Aircrack-ng](https://www.aircrack-ng.org/)
  - Screenshot all results and update Dradis issues


### MS3 (Day 5-8)
#### Post-Exploitation
  - Windows privilege escalation using sysinternals tools and PowerSploit
    - https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite
    - https://github.com/PowerShellMafia/PowerSploit
    - https://github.com/GoVanguard/script-win-privescalate-headstart
  - Privilege escalation through Metasploit shells or meterpreter instances
  - Screenshot all results and update Dradis issues

#### Data Roll Up
  - Create Maltego Maps (company intelligence & systems topology)
  - Manual screenshot data roll up
  - Both automated and manual exploit data roll up
  - Running PyDradis3 scripts on Dradis project for data sanitization (https://github.com/GoVanguard/pydradis3)
    - Requires Dradis API key


### MS4 (Day 8-12)
  - Generate Dradis Report
  - Word Document Customizations
    - Add in any additional screenshots and scale & crop as necessary
    - Check for proper language usage (Third-Person-Formal & Past Tense), particularly in risk data, conclusion, and any other customized areas (that are not part of the report template)
    - Look for and correct any non-sequiturs
    - Check for soft returns, spacing and correct font (Lato)
    - Ensure issue titles are all using Title Case
    - Ensure all fields contain proper entries (No n/a or empty fields)
    - Simplify summary, insight and mitigation fields wherever possible 
    - Add any references that might be missing
    - Format tables, lists or other data collections in clean easy to read tables with alternating colors
    - Insert page breaks where needed to ensure good flow of report
    - Check “Affected Hosts” for duplicates and trailing commas
    - Insert comments for any incomplete items
  - Proofread and Review
